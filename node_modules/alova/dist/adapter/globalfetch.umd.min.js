!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).GlobalFetch=t()}(this,(function(){"use strict";const e=Promise,t=Object,n=(e,t,n)=>e.then(t,n),o=e=>clearTimeout(e),r=e=>{const n=(o=e,t.prototype.toString.call(o));var o;return/^\[object (Blob|FormData|ReadableStream|URLSearchParams)\]$/i.test(n)||((e,t)=>e instanceof t)(e,ArrayBuffer)};const a=e=>"string"==typeof e||r(e);return function(){return function(t,r){const l=r.config,s=l.timeout||0,i=new AbortController;let c,u=false;s>0&&(c=((e,t=0)=>setTimeout(e,t))((()=>{u=true,i.abort()}),s));const f=t.data,d=fetch(t.url,{...l,method:t.type,signal:i.signal,body:a(f)?f:(b=f,JSON.stringify(b))});var b;return{response:()=>n(d,(e=>(o(c),e.clone())),(t=>(t=>e.reject(t))(((e,t)=>{const n=((e,...t)=>new e(...t))(Error,`[alova]${e}`);return t&&(n.name=t),n})(u?"fetchError: network timeout":t.message)))),headers:()=>n(d,(({headers:e})=>e),(()=>({}))),onDownload:e=>{n(d,(t=>{const{headers:o,body:r}=t.clone(),a=null==r?void 0:r.getReader().read(),l=Number(o.get("Content-Length")||o.get("content-length")||0);if(l<=0)return;let s=0;const i=setInterval((()=>{a&&n(a,(({done:t,value:n=new Uint8Array})=>{t&&clearInterval(i),s+=(e=>e.length)(n),e(l,s)}))}),0)}))},abort:()=>{i.abort(),o(c)}}}}}));
